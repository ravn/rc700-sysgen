;
; ЩЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЛ
; К This file is generated by The Interactive Disassembler (IDA) FW К
; К Copyright (c) 1997 by DataRescue sprl, <ida@datarescue.com>     К
; К Professional version of IDA is at http://www.idapro.com         К
; ШЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭМ
;


; File Name			  g:sysgen.com
; Format			  COM File
; Base Address:	1000h Range: 10100h - 10680h Loaded length: 0580h

; Processor:	    8085
; Target assembler: X-M-80 by Leo Sandy
.8080

;ЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭЭ

; segment 'seg000'
		cseg
		org 100h


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

start:
		jmp	startx
; End of function start

;ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ
aCopyrightC1978:db 20h
aCopyrightC19_0:db 'COPYRIGHT (C) 1978, DIGITAL RESEARCH                        '
		db 'COPYRIGHT (C) 1982, A/S REGNECENTRALEN AF 1979 '
		db    2	;  
spt:		db 0			; DATA XREF: getput+Ew	getput+4Ar
					; ...
rc_diskformat:	db 8			; DATA XREF: rc_track1+1Dr
					; getput+E9w ...
byte_0_172:	db 10h			; DATA XREF: rc_track1+11r
					; getput+EEw
byte_0_173:	db 18h			; DATA XREF: rc_track1+17r
					; getput+F3w
byte_0_174:	db 68h			; DATA XREF: getput+D3r getput+F8w
byte_0_175:	db 78h			; DATA XREF: getput+Br	getput+FDw
byte_0_176:	db 19h			; DATA XREF: rc_track1+Dr getput+34r
					; ...
byte_0_177:	db 34h			; DATA XREF: getput+3Br getput+107w
byte_0_178:	db 1Ah			; DATA XREF: getput+42r getput+10Cw
maxitrans:	db 0
		db    2	;  
		db    4	;  
		db    6	;  
		db    8	;  
		db  0Ah	;  
		db  0Ch	;  
		db  0Eh	;  
		db    1	;  
		db    3	;  
		db    5	;  
		db    7	;  
		db    9	;  
		db  0Bh	;  
		db  0Dh	;  
		db  0Fh	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
asc_0_199:	db ' !"#$'
unk_0_19E:	db  25h	; %
		db  26h	; &
unk_0_1A0:	db  27h	; '
		db  28h	; (
		db  29h	; )
		db  2Ah	; *
		db  2Bh	; +
		db  2Ch	; ,
byte_0_1A6:	db 2Dh
		db  2Eh	; .
		db  2Fh	; /
		db  30h	; 0
		db  31h	; 1
		db  32h	; 2
		db  33h	; 3
		db  34h	; 4
		db  35h	; 5
		db  36h	; 6
		db  37h	; 7
		db  38h	; 8
		db  39h	; 9
		db  3Ah	; :
		db  3Bh	; ;
		db  3Ch	; <
		db  3Dh	; =
		db  3Eh	; >
		db  3Fh	; ?
minitrans:	db    0	;  
		db    4	;  
		db    8	;  
		db 0Ch
		db  10h	;  
		db  14h	;  
		db  18h	;  
		db    1	;  
		db    5	;  
		db    9	;  
		db  0Dh	;  
		db  11h	;  
		db  15h	;  
		db  19h	;  
		db    2	;  
		db    6	;  
		db  0Ah	;  
		db  0Eh	;  
		db  12h	;  
		db  16h	;  
		db    3	;  
		db    7	;  
		db  0Bh	;  
		db  0Fh	;  
		db  13h	;  
		db  17h	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db  34h	; 4
		db  35h	; 5
		db  36h	; 6
		db  37h	; 7
		db  38h	; 8
		db  39h	; 9
		db  3Ah	; :
		db  3Bh	; ;
		db  3Ch	; <
		db  3Dh	; =
		db  3Eh	; >
		db  3Fh	; ?
		db  40h	; @
		db  41h	; A
		db  42h	; B
		db  43h	; C
		db  44h	; D
		db  45h	; E
		db  46h	; F
		db  47h	; G
		db  48h	; H
		db  49h	; I
		db  4Ah	; J
		db  4Bh	; K
		db  4Ch	; L
		db  4Dh	; M
		db  4Eh	; N
		db  4Fh	; O
		db  50h	; P
		db  51h	; Q
		db  52h	; R
		db  53h	; S
		db  54h	; T
		db  55h	; U
		db  56h	; V
		db  57h	; W
		db  58h	; X
		db  59h	; Y
		db  5Ah	; Z
		db  5Bh	; [
		db  5Ch	; \
		db  5Dh	; ]
		db  5Eh	; ^
		db  5Fh	; _
		db  60h	; `
		db  61h	; a
		db  62h	; b
		db  63h	; c
		db  64h	; d
		db  65h	; e
		db  66h	; f
		db  67h	; g

;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

multsec:				; CODE XREF: getput+7Dp getput+C8p
		mov	l, a
		mvi	h, 0
		dad	hl
		dad	hl
		dad	hl
		dad	hl
		dad	hl
		dad	hl
		dad	hl
		ret	
; End of function multsec


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

getchar:				; CODE XREF: getput+9Cp getput+170p
					; ...
		mvi	c, 1
		call	5
		cpi	61h
		rc	
		cpi	7Bh
		rnc	
		ani	5Fh
		ret	
; End of function getchar


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

putchar:				; CODE XREF: crlf+2p crlf+7p ...
		mov	e, a
		mvi	c, 2
		call	5
		ret	
; End of function putchar


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

crlf:					; CODE XREF: crmsg+1p getput+A4p
					; ...
		mvi	a, 0Dh
		call	putchar
		mvi	a, 0Ah
		call	putchar
		ret	
; End of function crlf


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

crmsg:					; CODE XREF: getput+12Ap getput+164p
					; ...
		push	hl
		call	crlf
		pop	hl
; End of function crmsg


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

outmsg:					; CODE XREF: outmsg+9j	getput+99p
					; ...
		mov	a, m
		ora	a
		rz	
		push	hl
		call	putchar
		pop	hl
		inx	hl
		jmp	outmsg
; End of function outmsg


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

sel:					; CODE XREF: rc_track1+38p
					; getput+18Cp ...
		sta	sdisk
		mov	c, a
		lhld	1
		lxi	de, 18h
		dad	de
		pchl	
; End of function sel


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

trk:					; CODE XREF: getput+1Cp
		lhld	1
		lxi	de, 1Bh
		dad	de
		pchl	
; End of function trk


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

sec:					; CODE XREF: getput+77p
		lhld	1
		lxi	de, 1Eh
		dad	de
		pchl	
; End of function sec


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

dma:					; CODE XREF: getput+87p getput+14Cp
		lhld	1
		lxi	de, 21h
		dad	de
		pchl	
; End of function dma


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

read:					; CODE XREF: getput+BBp
		lhld	1
		lxi	de, 24h
		dad	de
		pchl	
; End of function read


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

write:					; CODE XREF: getput+B5p
		lhld	1
		lxi	de, 27h
		dad	de
		mvi	c, 2
		pchl	
; End of function write


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

dread:					; CODE XREF: getput+13Ap getput+152p
		mvi	c, 14h
		jmp	5
; End of function dread


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

open:					; CODE XREF: getput+120p
		mvi	c, 0Fh
		jmp	5
; End of function open


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

rc_track1:				; CODE XREF: getput+24p
		lda	track
		cpi	1
		jnz	loc_0_2BA
		lda	sector
		inr	a
		mov	b, a
		lda	byte_0_176
		cmp	b
		lda	byte_0_172
		jnc	loc_0_2BD
		lda	byte_0_173
		jmp	loc_0_2BD
;ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ

loc_0_2BA:				; CODE XREF: rc_track1+5j
		lda	rc_diskformat

loc_0_2BD:				; CODE XREF: rc_track1+14j
					; rc_track1+1Aj
		lhld	1
		lxi	de, 34h
		dad	de
		push	psw
		lda	sdisk
		mov	b, a
		add	l
		mov	l, a
		jnc	loc_0_2CF
		inr	h

loc_0_2CF:				; CODE XREF: rc_track1+2Ej
		pop	psw
		mov	c, m
		cmp	c
		rz	
		mov	m, a
		mov	a, b
		call	sel
		ret	
; End of function rc_track1


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

getput:					; CODE XREF: getput+1A7p getput+1EBp
		lxi	hl, 900h
		shld	dmaddr
		mvi	a, 3
		sta	track
		lda	byte_0_175
		sta	spt

rwtrk:					; CODE XREF: getput+D9j
		lxi	hl, 61Ah
		dcr	m
		jz	endrw
		mov	c, m
		dcr	c
		mvi	b, 0
		call	trk
		mvi	a, 0FFh
		sta	sector

rwsec:					; CODE XREF: getput+A7j getput+BFj
		call	rc_track1
		lda	track
		cpi	1
		jnz	rwsec2
		lda	sector
		inr	a
		mov	b, a
		lda	byte_0_176
		cmp	b
		jnc	rwsec2
		lda	byte_0_177
		cmp	b
		jc	rwsec2
		lda	byte_0_178
		add	b
		dcr	a
		sta	sector

rwsec2:					; CODE XREF: getput+2Cj getput+38j
					; ...
		lda	spt
		lxi	hl, 61Bh
		inr	m
		cmp	m
		jz	endtrk
		lxi	hl, 61Bh

rc1:
		mov	c, m
		mvi	b, 0
		lda	track
		cpi	1
		jnz	rwsec1
		mov	e, m
		mvi	d, 0
		in	14h
		ani	80h		; maxi?
		lxi	hl, 179h
		jnz	rc2
		lxi	hl, 1B9h

rc2:					; CODE XREF: getput+6Dj
		mov	b, m
		dad	de
		mov	c, m

rwsec1:					; CODE XREF: getput+60j
		push	bc
		call	sec
		pop	bc
		mov	a, c
		sub	b
		call	multsec
		xchg	
		lhld	dmaddr
		dad	de
		mov	b, h
		mov	c, l
		call	dma
		xra	a
		sta	retry

trysec:					; CODE XREF: getput+C2j
		lda	retry
		cpi	0Ah
		jc	tryok
		lxi	hl, 592h
		call	outmsg
		call	getchar
		cpi	0Dh
		jnz	reboot
		call	crlf
		jmp	rwsec
;ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ

tryok:					; CODE XREF: getput+93j
		inr	a
		sta	retry
		lda	rw
		ora	a
		jz	tryread
		call	write
		jmp	chkrw
;ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ

tryread:				; CODE XREF: getput+B2j
		call	read

chkrw:					; CODE XREF: getput+B8j
		ora	a
		jz	rwsec
		jmp	trysec
;ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ

endtrk:					; CODE XREF: getput+52j
		lda	spt
		call	multsec
		xchg	
		lhld	dmaddr
		dad	de
		shld	dmaddr
		lda	byte_0_174
		sta	spt
		jmp	rwtrk
;ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ

endrw:					; CODE XREF: getput+15j
		ret	
;ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ

startx:					; CODE XREF: startj
		lxi	sp, 640h
		in	14h
		ani	80h
		jz	rc_notmaxi
		mvi	a, 10h
		sta	rc_diskformat
		mvi	a, 0
		sta	byte_0_172
		mvi	a, 8
		sta	byte_0_173
		mvi	a, 40h
		sta	byte_0_174
		mvi	a, 48h
		sta	byte_0_175
		mvi	a, 0Fh
		sta	byte_0_176
		mvi	a, 20h
		sta	byte_0_177
		mvi	a, 10h
		sta	byte_0_178

rc_notmaxi:				; CODE XREF: getput+E4j
		lxi	hl, 4EFh
		call	outmsg
		lda	5Dh
		cpi	20h
		jz	getsys
		lxi	de, 5Ch
		call	open
		inr	a
		jnz	rdok
		lxi	hl, 5EBh
		call	crmsg
		jmp	reboot
;ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ

rdok:					; CODE XREF: getput+124j
		xra	a
		sta	7Ch
		mvi	c, 10h

prerd:					; CODE XREF: getput+143j
		push	bc
		lxi	de, 5Ch
		call	dread
		pop	bc
		ora	a
		jnz	badrd
		dcr	c
		jnz	prerd
		lxi	hl, 900h

rdinp:					; CODE XREF: getput+15Ej
		push	hl
		mov	b, h
		mov	c, l
		call	dma
		lxi	de, 5Ch
		call	dread
		pop	hl
		ora	a
		jnz	putsys
		lxi	de, 80h
		dad	de
		jmp	rdinp
;ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ

badrd:					; CODE XREF: getput+13Fj
		lxi	hl, 602h
		call	crmsg
		jmp	reboot
;ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ

getsys:					; CODE XREF: getput+11Aj getput+182j
		lxi	hl, 4FEh
		call	crmsg
		call	getchar
		cpi	0Dh
		jz	putsys
		sui	41h
		cpi	2
		jc	getc
		call	baddisk
		jmp	getsys
;ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ

getc:					; CODE XREF: getput+17Cj
		adi	41h
		sta	gdisk
		sui	41h
		call	sel
		call	crlf
		lxi	hl, 524h
		call	outmsg
		call	getchar
		cpi	0Dh
		jnz	reboot
		call	crlf
		xra	a
		sta	rw
		call	getput
		lxi	hl, 5B9h
		call	outmsg

putsys:					; CODE XREF: getput+157j getput+175j
					; ...
		lxi	hl, 542h
		call	crmsg
		call	getchar
		cpi	0Dh
		jz	reboot
		sui	41h
		cpi	2
		jc	putc
		call	baddisk
		jmp	putsys
;ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ

putc:					; CODE XREF: getput+1C2j
		adi	41h
		sta	pdisk
		sui	41h
		call	sel
		lxi	hl, 56Fh
		call	crmsg
		call	getchar
		cpi	0Dh
		jnz	reboot
		call	crlf
		lxi	hl, 61Ch
		mvi	m, 1
		call	getput
		lxi	hl, 5B9h
		call	outmsg
		jmp	putsys
;ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ

reboot:					; CODE XREF: getput+A1j getput+12Dj
					; ...
		lda	rc_diskformat
		lhld	1
		lxi	de, 34h
		dad	de
		mov	m, a
		inx	hl
		mov	m, a
		mvi	a, 0
		call	sel
		call	crlf
		jmp	0
; End of function getput


;лллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллллл

;		S u b r	o u t i	n e

baddisk:				; CODE XREF: getput+17Fp getput+1C5p
		lxi	hl, 5CBh
		call	crmsg
		ret	
; End of function baddisk

;ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ
signon:		db 'SYSGEN VER 2.0',0
askget:		db 'SOURCE DRIVE NAME (OR RETURN TO SKIP)',0
getmsg:		db 'SOURCE ON '
gdisk:		db 0E1h			; DATA XREF: getput+187w
asc_0_52F:	db ', '
aThenTypeRetu_0:db 'THEN TYPE RETURN',0
askput:		db 'DESTINATION DRIVE NAME (OR RETURN TO REBOOT)',0
putmsg:		db 'DESTINATION ON '
pdisk:		db 1Ch			; DATA XREF: getput+1CDw
aThenTypeReturn:db ', THEN TYPE RETURN',0
errmsg:		db 'PERMANENT ERROR, TYPE RETURN TO IGNORE',0
done:		db 'FUNCTION COMPLETE',0
qdisk:		db 'INVALID DRIVE NAME (USE A OR B)',0
nofile:		db 'NO SOURCE FILE ON DISK',0
badfile:	db 'SOURCE FILE INCOMPLETE',0
sdisk:		db 0			; DATA XREF: selw rc_track1+28r
track:		db 0			; DATA XREF: rc_track1r getput+8w
					; ...
sector:		db 0			; DATA XREF: rc_track1+8r getput+21w
					; ...
rw:		db 0			; DATA XREF: getput+AEr getput+1A4w
dmaddr:		dw 0			; DATA XREF: getput+3w	getput+81r
					; ...
retry:		db 0			; DATA XREF: getput+8Bw getput+8Er
					; ...
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  
		db    0	;  

; end of 'seg000'


		end start
